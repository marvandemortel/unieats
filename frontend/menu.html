<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>UniEats - MenÃº</title>
  <link rel="stylesheet" href="estilos.css">
</head>
<body>
<div id="app">
  <h1>Â¡Bienvenida!</h1>

  <label>MENÃš</label>
  <select v-model="categoria">
    <option value="">Todas</option>
    <option value="comida">Comida</option>
    <option value="panificado">Panificados</option>
    <option value="bebida">Bebidas</option>
    <option value="promo">Promos</option>
  </select>

  <ul class="lista">
    <li v-for="p in filtrados" :key="p.id" class="item">
      <div class="txt">
        <span class="ico">{{ icono(p) }}</span>
        <span>{{ p.nombre }} â€” ${{ p.precio }}</span>
      </div>
      <button @click="agregar(p.id)">Agregar</button>
    </li>
  </ul>

  <div class="nav-bottom">
    <span class="ico">ðŸ“‹ï¸Ž</span><span> Mis Pedidos</span>
    <span class="ico">ðŸ””ï¸Ž</span><span> Notificaciones</span>
    <span class="ico">ðŸ‘¤ï¸Ž</span><span> Mi Perfil</span>
  </div>
</div>

<!-- Vue y Axios por CDN -->
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
function param(n){ return new URL(location.href).searchParams.get(n); }

new Vue({
  el:'#app',
  data:{
    uni: (param('uni')||'ucema').toLowerCase(),
    pedido: param('pedido'),
    categoria:'',
    productos:[]
  },
  created(){ this.cargar(); },
  computed:{
    filtrados(){
      if(!this.categoria) return this.productos;
      return this.productos.filter(p=>p.categoria===this.categoria);
    }
  },
  methods:{
    cargar(){
      const base='http://127.0.0.1:4000';
      axios.get(base+'/api/productos?uni='+this.uni)
        .then(r=> this.productos=r.data)
        .catch(()=> alert('Error cargando menÃº'));
    },
    // Emojis B/N (variante texto): comida ðŸ½ï¸Ž, panificado ðŸ¥ï¸Ž, bebidas â˜•ï¸Ž si es cafÃ© sino ðŸ¥¤ï¸Ž, promo â˜…
    icono(p){
      const nombre = (p.nombre||'').toLowerCase();
      if(p.categoria==='comida')     return 'ðŸ½ï¸Ž';
      if(p.categoria==='panificado') return 'ðŸ¥ï¸Ž';
      if(p.categoria==='bebida'){
        if(nombre.indexOf('cafe')>-1 || nombre.indexOf('cafÃ©')>-1 || nombre.indexOf('tÃ©')>-1 || nombre.indexOf('te ')===0) return 'â˜•ï¸Ž';
        return 'ðŸ¥¤ï¸Ž';
      }
      if(p.categoria==='promo')      return 'â˜…';
      return 'â—¼ï¸Ž';
    },
    agregar(producto_id){
      const base='http://127.0.0.1:4000';
      // si aÃºn no tenÃ©s carrito/pedido armado, podÃ©s redirigir a carrito con este producto
      axios.put(base+'/api/pedidos/'+this.pedido, { items:[{id:producto_id, cantidad:1}] })
        .then(()=> window.location='pago.html?uni='+this.uni+'&pedido='+this.pedido+'&producto='+producto_id)
        .catch(()=> alert('Error agregando'));
    }
  }
});
</script>
</body>
</html>
