<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>UniEats - Staff</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="estilos.css" />
</head>
<body>
  <div id="app" class="page">
    <div class="card">
      <h1 class="title" style="margin:6px 0 12px;color:#173a77">Productos</h1>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:920px">
        <div>
          <label>Nombre</label>
          <input v-model.trim="form.nombre" placeholder="Ej: Caf√© chico">
        </div>
        <div>
          <label>Precio</label>
          <input v-model.number="form.precio" type="number" min="0" step="1" placeholder="Ej: 1200">
        </div>
        <div>
          <label>Categor√≠a</label>
          <select v-model="form.categoria">
            <option>comida</option>
            <option>panificado</option>
            <option>bebida</option>
            <option>promo</option>
          </select>
        </div>
        <div>
          <label>Universidad</label>
          <select v-model="form.uni">
            <option value="ucema">UCEMA</option>
            <option value="generic">Otra</option>
          </select>
        </div>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <button class="btn-primary" @click="guardar" :disabled="enviandoProd">
          {{ enviandoProd ? 'Guardando‚Ä¶' : (form.id ? 'Actualizar' : 'Agregar') }}
        </button>
        <button class="btn-primary" style="background:#6b7280" @click="cancelarEdicion" :disabled="enviandoProd">Cancelar</button>
      </div>
      <p v-if="msg" class="badge">{{ msg }}</p>
      <p v-if="errorProd" class="error">{{ errorProd }}</p>

      <div style="display:flex;gap:10px;align-items:center;margin-top:14px;flex-wrap:wrap">
        <label style="margin:0">Filtrar por:</label>
        <select v-model="filtro.cat" style="max-width:180px">
          <option value="">(todas las categor√≠as)</option>
          <option>comida</option><option>panificado</option><option>bebida</option><option>promo</option>
        </select>
        <select v-model="filtro.uni" style="max-width:150px">
          <option value="">(todas las unis)</option>
          <option value="ucema">UCEMA</option>
          <option value="generic">Otra</option>
        </select>
        <input v-model.trim="filtro.q" placeholder="Buscar nombre‚Ä¶" style="max-width:240px">
        <span style="margin-left:auto;font-weight:700">Total: {{ productosFiltrados.length }}</span>
      </div>

      <ul class="list" style="margin-top:10px">
        <li class="item" v-for="p in productosFiltrados" :key="p.id">
          <span>
            <strong>#{{ p.id }}</strong> ‚Äî {{ p.nombre }}
            <small style="opacity:.7">[{{ p.categoria }} ¬∑ {{ p.uni }}]</small>
          </span>
          <span>
            <span class="badge">\${{ p.precio }}</span>
            <button class="btn-primary" style="margin-left:8px;padding:8px 10px" @click="editar(p)">Editar</button>
            <button class="btn-primary" style="margin-left:6px;background:#b00020;padding:8px 10px"
                    @click="borrar(p)" :disabled="enviandoProd">Borrar</button>
          </span>
        </li>
      </ul>
    </div>

    <div class="card">
      <h1 class="title" style="margin:6px 0 12px;color:#173a77">Pedidos</h1>

      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <label style="margin:0">Estado</label>
        <select v-model="filtroPed.estado" style="max-width:180px" @change="cargarPedidos">
          <option value="">(todos)</option>
          <option value="pendiente">pendiente</option>
          <option value="en_preparacion">en_preparacion</option>
          <option value="listo">listo</option>
        </select>
        <label style="margin-left:8px;margin-right:0">Desde hora</label>
        <input v-model="filtroPed.desde" placeholder="HH:MM (opcional)" style="max-width:130px">
        <button class="btn-primary" style="padding:8px 12px" @click="cargarPedidos" :disabled="cargandoPed">
          {{ cargandoPed ? 'Cargando‚Ä¶' : 'Actualizar' }}
        </button>
        <span style="margin-left:auto;font-weight:700">Total: {{ pedidos.length }}</span>
      </div>

      <ul class="list" style="margin-top:10px">
        <li class="item" v-for="pd in pedidos" :key="pd.id">
          <div style="display:flex;flex-direction:column">
            <strong>Pedido #{{ pd.id }}</strong>
            <small style="opacity:.75">
              email: {{ pd.email || '-' }} ¬∑ uni: {{ pd.uni || 'ucema' }} ¬∑ estado: {{ pd.estado || 'pendiente' }} ¬∑ pago: {{ pd.pago || 'pendiente' }} ¬∑ hora: {{ pd.hora || '-' }}
            </small>
          </div>
          <div style="display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end">
            <button class="btn-primary" style="padding:8px 10px" @click="setEstado(pd,'en_preparacion')" :disabled="cargandoPed">Preparar</button>
            <button class="btn-primary" style="padding:8px 10px" @click="setEstado(pd,'listo')" :disabled="cargandoPed">Listo</button>
            <button class="btn-primary" style="padding:8px 10px;background:#0f766e" @click="setPago(pd,'confirmado')" :disabled="cargandoPed">Pago OK</button>
          </div>
        </li>
      </ul>
      <p v-if="errorPed" class="error">{{ errorPed }}</p>
    </div>

    <nav class="nav-bottom">
      <a class="nav-item" href="./mi-pedido.html"><span class="ico">üìãÔ∏é</span><span>Mis Pedidos</span></a>
      <a class="nav-item" href="./menu.html"><span class="ico">üçΩÔ∏è</span><span>Menu</span></a>
    </nav>
  </div>

  <script src="https://unpkg.com/vue@2.7.16/dist/vue.js"></script>
  <script src="js/ue.js"></script>
  <script src="js/staff.js"></script>

</body>
</html>

