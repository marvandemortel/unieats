<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>UniEats - Iniciar sesiÃ³n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="estilos.css" />
</head>
<body>
  <div id="app" class="page login">
    <div class="card">
      <img src="img/logo.png" alt="UniEats" class="logo" />
      <h2 class="brand"><span class="brand-uni">Uni</span><span class="brand-e">E</span>ats</h2>
      <h1 class="title">Iniciar sesiÃ³n</h1>

      <label for="email">Email</label>
      <input id="email" type="email" v-model="email" placeholder="nombre@ucema.edu.ar" />

      <label for="pass">ContraseÃ±a</label>
      <input id="pass" type="password" v-model="pass" placeholder="********" />

      <label for="uni">Universidad</label>
      <select id="uni" v-model="uni">
        <option>UCEMA</option>
        <option>Otra</option>
      </select>

      <button class="btn-primary btn-narrow" @click="iniciar" :disabled="cargando">
        {{ cargando ? 'Creando pedidoâ€¦' : 'Iniciar sesiÃ³n' }}
      </button>

      <p v-if="error" class="error">{{ error }}</p>
    </div>

    <nav class="nav-bottom">
      <a class="nav-item" href="#"><span class="ico">ðŸ“‹ï¸Ž</span><span>Mis Pedidos</span></a>
      <a class="nav-item" href="#"><span class="ico">ðŸ””ï¸Ž</span><span>Notificaciones</span></a>
      <a class="nav-item" href="#"><span class="ico">ðŸ‘¤ï¸Ž</span><span>Mi Perfil</span></a>
    </nav>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    new Vue({
      el: '#app',
      data: { email:'', pass:'', uni:'UCEMA', cargando:false, error:'' },
      methods:{
        iniciar(){
          this.error='';
          if(!this.email || this.email.indexOf('@')===-1){ this.error='IngresÃ¡ un email vÃ¡lido.'; return; }
          if(!this.pass){ this.error='IngresÃ¡ la contraseÃ±a.'; return; }

          this.cargando=true;
          const base='http://127.0.0.1:4000';
          const uniParam = (this.uni === 'UCEMA') ? 'ucema' : 'generic';

          axios.post(base+'/login',{username:this.email,password:this.pass||'ok'})
          .then(()=> axios.post(base+'/api/pedidos',{uni:uniParam}))
          .then(r=>{
            const id=r.data.id;
            // guardo carrito vacÃ­o
            localStorage.setItem('carrito', JSON.stringify([]));
            window.location='menu.html?uni='+uniParam+'&pedido='+id;
          })
          .catch(()=> this.error='No se pudo iniciar. ProbÃ¡ de nuevo.')
          .then(()=> this.cargando=false);
        }
      }
    });
  </script>
</body>
</html>
