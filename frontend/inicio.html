<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>UniEats - Iniciar sesión</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="estilos.css" />
</head>
<body>
  <div id="app" class="login-wrap">
    <div class="login-card">
      <img src="img/logo.png" alt="Logo UniEats" class="logo" />

      <h1 class="brand">Uni<span class="brand-e">E</span>ats</h1>
      <h2 class="login-title">Iniciar sesión</h2>

      <label for="email">Email</label>
      <input id="email" type="email" v-model="email" placeholder="nombre@ucema.edu.ar" />

      <label for="pass">Contraseña</label>
      <input id="pass" type="password" v-model="pass" placeholder="********" />

      <label for="uni">Universidad</label>
      <select id="uni" v-model="uni">
        <option value="ucema">UCEMA</option>
        <option value="otra">Otra</option>
      </select>

      <button class="btn-primary btn-narrow" @click="iniciar" :disabled="cargando">
        {{ cargando ? 'Creando pedido…' : 'Iniciar sesión' }}
      </button>

      <p v-if="error" class="error" style="margin-top:10px">{{ error }}</p>
    </div>
  </div>

  <!-- Vue + Axios por CDN -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>
  new Vue({
    el: '#app',
    data: {
      email: '',
      pass: '',
      uni: 'ucema',
      cargando: false,
      error: ''
    },
    methods: {
      async iniciar () {
        this.error = '';

        // Validaciones mínimas
        if (!this.email || this.email.indexOf('@') === -1) {
          this.error = 'Ingresá un email válido.'; return;
        }
        if (!this.pass || !this.pass.trim()) {
          this.error = 'Ingresá tu contraseña.'; return;
        }

        this.cargando = true;
        const base = 'http://127.0.0.1:4000';

        try {
          // 1) Login (el backend acepta cualquier password no vacía para el TP)
          await axios.post(base + '/login', {
            username: this.email,
            password: this.pass
          });

          // 2) Crear pedido base y redirigir a menú
          const r = await axios.post(base + '/api/pedidos', {
            uni: this.uni
          });

          const id = r.data && r.data.id ? r.data.id : 1;
          const qs = `uni=${encodeURIComponent(this.uni)}&pedido=${encodeURIComponent(id)}`;
          window.location = 'menu.html?' + qs;

        } catch (e) {
          this.error = 'No se pudo iniciar sesión. Probá de nuevo.';
        } finally {
          this.cargando = false;
        }
      }
    }
  });
  </script>
</body>
</html>
